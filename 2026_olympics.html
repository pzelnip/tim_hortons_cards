<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
/* Base reset & typography */
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    line-height: 1.5;
    margin: 0;
    padding: 2rem;
    background: linear-gradient(135deg, #fff 0%, #f7f7f7 100%);
    color: #1a1a1a;
}

/* Page title */
h1 {
    text-align: center;
    margin-bottom: 2rem;
    color: #d71920; /* Canada red */
    text-shadow: 1px 1px 2px #aaa;
    font-weight: bold;
}

/* Section headings */
h2 {
    margin-top: 2.5rem;
    margin-bottom: 0.75rem;
    padding-bottom: 0.25rem;
    border-bottom: 2px solid #d71920; /* red underline */
    font-size: 1.25rem;
    color: #d71920;
}

/* List containers */
ul {
    background: #fff;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(215, 25, 32, 0.15); /* red-tinted shadow */
    border: 2px solid #d71920;
}

/* List items ‚Äî full-row clickable */
ul li {
    padding: 0.25rem 0;
    transition: color 0.2s;
}

/* Checkboxes */
input[type="checkbox"] {
    transform: scale(1.2);
    cursor: pointer;
    accent-color: #d71920; /* checkbox in Canadian red */
}

/* Labels ‚Äî full-row clickable area */
label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

/* Optional hover effect */
ul li:hover {
    background-color: #ffe6e6; /* light red highlight */
    border-radius: 6px;
}

/* Strikethrough text when checkbox is checked (CSS-only) */
li:has(input[type="checkbox"]:checked) {
    color: #555;
    text-decoration: line-through;
    text-decoration-color: #555;
}
li {
    text-decoration-color: transparent;
    transition: text-decoration-color 0.2s;
}

/* Overall progress styling */
#overall-count {
    font-size: 1.15rem;
    color: #d71920;
    font-weight: bold;
}

/* Add subtle maple leaf icons before section headings */
h2::before {
    content: "üçÅ ";
    margin-right: 0.25rem;
}

/* Add a maple leaf background accent for fun */
body::before {
    content: "üçÅ";
    position: fixed;
    font-size: 200px;
    opacity: 0.05;
    top: 20%;
    left: 75%;
    pointer-events: none;
}

/* Button row */
.button-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 2rem;
}

/* Share button */
#share-btn {
    padding: 0.5rem 1.5rem;
    background: #d71920;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
}
#share-btn:hover {
    background: #b5161c;
}
#clear-btn {
    padding: 0.5rem 1.5rem;
    background: #fff;
    color: #d71920;
    border: 2px solid #d71920;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
}
#clear-btn:hover {
    background: #d71920;
    color: white;
}
#hide-checked-btn {
    padding: 0.5rem 1.5rem;
    background: #fff;
    color: #d71920;
    border: 2px solid #d71920;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
}
#hide-checked-btn:hover {
    background: #d71920;
    color: white;
}
body.show-unchecked li:has(input[type="checkbox"]:checked) {
    display: none;
}
body.show-checked li:has(input[type="checkbox"]:not(:checked)) {
    display: none;
}

/* Category navigation tabs */
#category-nav {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: #fff;
    border: 2px solid #d71920;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(215, 25, 32, 0.15);
    margin-bottom: 2rem;
}
#category-nav button {
    padding: 0.4rem 1rem;
    background: #fff;
    color: #d71920;
    border: 2px solid #d71920;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: bold;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.2s, color 0.2s;
}
#category-nav button:hover {
    background: #d71920;
    color: #fff;
}
#category-nav button.active {
    background: #d71920;
    color: #fff;
}
#category-nav button .badge {
    font-size: 0.7rem;
    opacity: 0.85;
    margin-left: 0.15rem;
}

/* Tab content panels */
.tab-content {
    display: none;
}
.tab-content.active {
    display: block;
    animation: fadeIn 0.25s ease-in;
}
.tab-content h2 {
    margin-top: 0.5rem;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

    </style>
</head>
<body>
    <h1 id="page-title"></h1>

<div style="max-width:600px; margin:0 auto 2rem;">
    <div id="progress-container" style="background:#eee; border-radius:12px; overflow:hidden; height:16px;">
        <div id="progress-bar" style="height:100%; width:0%; background:#d71920; transition: width 0.3s;"></div>
    </div>
    <div id="progress-label" style="text-align:center; color:#d71920; font-weight:bold; font-size:1rem; margin-top:0.35rem;">0/0 (0%)</div>
</div>
<div class="button-row">
    <button id="share-btn">Copy Share Link</button>
    <button id="clear-btn">Clear Selections</button>
    <button id="hide-checked-btn">Show Needed</button>
</div>

<nav id="category-nav"></nav>

<div id="card-content"></div>

<script>
// --- Rendering ---

function renderSet(data) {
    document.getElementById('page-title').textContent = data.title;
    document.title = data.title;

    // Build nav tabs
    const nav = document.getElementById('category-nav');
    data.categories.forEach((cat, i) => {
        const btn = document.createElement('button');
        btn.dataset.target = cat.tabId;
        if (i === 0) btn.classList.add('active');
        const badge = document.createElement('span');
        badge.className = 'badge';
        btn.appendChild(document.createTextNode(cat.tabLabel + ' '));
        btn.appendChild(badge);
        nav.appendChild(btn);
    });

    // Build tab content panels
    const content = document.getElementById('card-content');
    data.categories.forEach((cat, i) => {
        const div = document.createElement('div');
        div.className = 'tab-content' + (i === 0 ? ' active' : '');
        div.id = cat.tabId;

        // Section heading
        const h2 = document.createElement('h2');
        const endNum = cat.cards.length;
        let rangeStr;
        if (cat.showPrefix) {
            rangeStr = cat.prefix + '-1\u2013' + cat.prefix + '-' + endNum;
        } else {
            rangeStr = '1\u2013' + endNum;
        }
        let headingText = cat.name + ' (' + rangeStr + ')';
        if (cat.odds) headingText += ' ' + cat.odds;
        h2.appendChild(document.createTextNode(headingText + ' '));
        const countSpan = document.createElement('span');
        countSpan.className = 'count';
        h2.appendChild(countSpan);
        div.appendChild(h2);

        // Card list
        const ul = document.createElement('ul');
        cat.cards.forEach((name, idx) => {
            const num = idx + 1;
            const checkboxId = cat.prefix + '-' + num;
            let labelText;
            if (cat.showPrefix) {
                labelText = cat.prefix + '-' + num + ' ' + name;
            } else {
                labelText = num + ' - ' + name;
            }

            const li = document.createElement('li');
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = checkboxId;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(' ' + labelText));
            li.appendChild(label);
            ul.appendChild(li);
        });
        div.appendChild(ul);
        content.appendChild(div);
    });
}

// --- State encode/decode ---

function encodeState() {
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const bytes = new Uint8Array(Math.ceil(checkboxes.length / 8));
    checkboxes.forEach((cb, i) => {
        if (cb.checked) bytes[i >> 3] |= (1 << (7 - (i & 7)));
    });
    return btoa(String.fromCharCode(...bytes))
        .replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
}

function decodeState(hash) {
    const b64 = hash.replace(/-/g, "+").replace(/_/g, "/");
    const binary = atob(b64);
    const bytes = new Uint8Array([...binary].map(c => c.charCodeAt(0)));
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach((cb, i) => {
        cb.checked = !!(bytes[i >> 3] & (1 << (7 - (i & 7))));
    });
}

function loadState() {
    const hash = window.location.hash.slice(1);
    if (hash) {
        decodeState(hash);
    }
}

function updateHash() {
    const encoded = encodeState();
    history.replaceState(null, "", window.location.pathname + window.location.search + "#" + encoded);
}

function saveState() {
    updateHash();
}

function updateCounts() {
    let grandTotal = 0;
    let grandChecked = 0;

    document.querySelectorAll("h2").forEach(h2 => {
        const list = h2.nextElementSibling;
        if (!list || !["UL", "OL"].includes(list.tagName)) return;

        const checkboxes = list.querySelectorAll('input[type="checkbox"]');
        const checked = list.querySelectorAll('input[type="checkbox"]:checked');

        const total = checkboxes.length;
        const checkedCount = checked.length;
        const percent = total === 0 ? 0 : Math.round((checkedCount / total) * 100);

        grandTotal += total;
        grandChecked += checkedCount;

        let countSpan = h2.querySelector(".count");
        if (!countSpan) {
            countSpan = document.createElement("span");
            countSpan.className = "count";
            h2.appendChild(countSpan);
        }

        countSpan.textContent = `(${checkedCount}/${total} ‚Äî ${percent}%)`;

        // Update badge on corresponding tab button
        const tabDiv = h2.closest('.tab-content');
        if (tabDiv) {
            const navBtn = document.querySelector(`#category-nav button[data-target="${tabDiv.id}"]`);
            if (navBtn) {
                const badge = navBtn.querySelector('.badge');
                if (badge) badge.textContent = `${checkedCount}/${total}`;
            }
        }
    });

    // Update progress bar and label
    const overallPercent = grandTotal === 0 ? 0 : Math.round((grandChecked / grandTotal) * 100);
    const progressBar = document.getElementById("progress-bar");
    if (progressBar) progressBar.style.width = overallPercent + "%";
    const progressLabel = document.getElementById("progress-label");
    if (progressLabel) progressLabel.textContent = `${grandChecked}/${grandTotal} (${overallPercent}%)`;
}

// --- Tab navigation ---

function openTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    document.querySelectorAll('#category-nav button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.target === tabId);
    });
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --- Event listeners ---

function attachEventListeners() {
    // Save state and update counts on checkbox changes
    document.addEventListener("change", e => {
        if (e.target.matches('input[type="checkbox"]')) {
            saveState();
            updateCounts();
        }
    });

    // Copy share link button
    document.getElementById("share-btn").addEventListener("click", () => {
        const btn = document.getElementById("share-btn");
        navigator.clipboard.writeText(window.location.href).then(() => {
            btn.textContent = "Copied!";
            setTimeout(() => { btn.textContent = "Copy Share Link"; }, 2000);
        });
    });

    // Clear all selections / Undo
    let previousHash = null;
    document.getElementById("clear-btn").addEventListener("click", () => {
        const btn = document.getElementById("clear-btn");
        if (previousHash !== null) {
            decodeState(previousHash);
            saveState();
            updateCounts();
            previousHash = null;
            btn.textContent = "Clear Selections";
        } else {
            previousHash = encodeState();
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            saveState();
            updateCounts();
            btn.textContent = "Undo";
        }
    });

    // Filter toggle: Show All ‚Üí Show Unchecked ‚Üí Show Checked
    const filterStates = ["all", "unchecked", "checked"];
    const filterLabels = { all: "Show Needed", unchecked: "Show Have", checked: "Show All" };
    let filterIndex = 0;

    document.getElementById("hide-checked-btn").addEventListener("click", () => {
        document.body.classList.remove("show-unchecked", "show-checked");
        filterIndex = (filterIndex + 1) % 3;
        const state = filterStates[filterIndex];
        if (state !== "all") document.body.classList.add("show-" + state);
        document.getElementById("hide-checked-btn").textContent = filterLabels[state];
    });

    // Handle hash changes (e.g. user pastes a new hash in the address bar)
    window.addEventListener("hashchange", () => {
        loadState();
        updateCounts();
    });

    // Category navigation tabs
    document.getElementById('category-nav').addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-target]');
        if (btn) openTab(btn.dataset.target);
    });

    // Keyboard navigation for tabs (arrow keys)
    document.getElementById('category-nav').addEventListener('keydown', (e) => {
        if (e.key !== 'ArrowLeft' && e.key !== 'ArrowRight') return;
        const buttons = Array.from(document.querySelectorAll('#category-nav button'));
        const current = buttons.indexOf(document.activeElement);
        if (current === -1) return;
        const next = e.key === 'ArrowRight'
            ? (current + 1) % buttons.length
            : (current - 1 + buttons.length) % buttons.length;
        buttons[next].focus();
        openTab(buttons[next].dataset.target);
    });
}

// --- Init ---

async function init() {
    const params = new URLSearchParams(window.location.search);
    const setName = params.get('set') || '2026_olympics';

    const response = await fetch('data/' + setName + '.json');
    if (!response.ok) {
        document.getElementById('page-title').textContent = 'Error: Card set not found';
        return;
    }
    const data = await response.json();

    renderSet(data);
    loadState();
    updateHash();
    updateCounts();
    attachEventListeners();
}

init();
</script>


</body>
</html>
